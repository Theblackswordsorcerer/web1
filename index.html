npm install three @react-three/fiber @react-three/drei
'use client'

import React, { useRef, useState } from 'react'
import { Canvas, useFrame, useThree } from '@react-three/fiber'
import { Box, Plane, Text } from '@react-three/drei'
import { Vector3 } from 'three'

// Player component
const Player = ({ position }) => {
  const ref = useRef()
  const { camera } = useThree()
  
  useFrame(() => {
    if (ref.current) {
      ref.current.position.copy(position)
      camera.position.copy(position).add(new Vector3(0, 1, 0))
    }
  })

  return (
    <Box ref={ref} args={[1, 2, 1]} position={position}>
      <meshStandardMaterial color="blue" />
    </Box>
  )
}

// Enemy component
const Enemy = ({ position }) => {
  return (
    <Box args={[1, 2, 1]} position={position}>
      <meshStandardMaterial color="red" />
    </Box>
  )
}

// Bullet component
const Bullet = ({ position, direction }) => {
  const ref = useRef()

  useFrame(() => {
    if (ref.current) {
      ref.current.position.add(direction.multiplyScalar(0.5))
    }
  })

  return (
    <Box ref={ref} args={[0.2, 0.2, 0.2]} position={position}>
      <meshStandardMaterial color="yellow" />
    </Box>
  )
}

// Main game component
export default function KrunkerGame() {
  const [playerPosition, setPlayerPosition] = useState(new Vector3(0, 1, 0))
  const [enemies, setEnemies] = useState([
    new Vector3(5, 1, 5),
    new Vector3(-5, 1, -5),
    new Vector3(5, 1, -5),
    new Vector3(-5, 1, 5),
  ])
  const [bullets, setBullets] = useState([])
  const [score, setScore] = useState(0)

  const handleKeyDown = (e) => {
    const speed = 0.5
    switch (e.key) {
      case 'w':
        setPlayerPosition(prev => new Vector3(prev.x, prev.y, prev.z - speed))
        break
      case 's':
        setPlayerPosition(prev => new Vector3(prev.x, prev.y, prev.z + speed))
        break
      case 'a':
        setPlayerPosition(prev => new Vector3(prev.x - speed, prev.y, prev.z))
        break
      case 'd':
        setPlayerPosition(prev => new Vector3(prev.x + speed, prev.y, prev.z))
        break
    }
  }

  const handleClick = () => {
    const direction = new Vector3(0, 0, -1)
    setBullets(prev => [...prev, { position: playerPosition.clone(), direction }])
  }

  useFrame(() => {
    // Check for collisions
    bullets.forEach((bullet, bulletIndex) => {
      enemies.forEach((enemy, enemyIndex) => {
        if (bullet.position.distanceTo(enemy) < 1) {
          // Remove the enemy and bullet
          setEnemies(prev => prev.filter((_, i) => i !== enemyIndex))
          setBullets(prev => prev.filter((_, i) => i !== bulletIndex))
          setScore(prev => prev + 1)
        }
      })
    })

    // Remove bullets that have gone too far
    setBullets(prev => prev.filter(bullet => bullet.position.length() < 100))
  })

  return (
    <div className="w-full h-screen" onKeyDown={handleKeyDown} onClick={handleClick} tabIndex={0}>
      <Canvas>
        <ambientLight intensity={0.5} />
        <pointLight position={[10, 10, 10]} />
        <Player position={playerPosition} />
        {enemies.map((position, index) => (
          <Enemy key={index} position={position} />
        ))}
        {bullets.map((bullet, index) => (
          <Bullet key={index} position={bullet.position} direction={bullet.direction} />
        ))}
        <Plane args={[100, 100]} rotation={[-Math.PI / 2, 0, 0]} position={[0, 0, 0]}>
          <meshStandardMaterial color="green" />
        </Plane>
        <Text position={[0, 5, -10]} color="white" fontSize={1}>
          Score: {score}
        </Text>
      </Canvas>
    </div>
  )
}
